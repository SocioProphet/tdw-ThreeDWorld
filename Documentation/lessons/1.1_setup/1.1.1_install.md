# 1.1.1 Installing TDW

## Core Concepts

- **The build** is the 3D simulation environment. It is a windowed application that requires a display and a GPU.
- **The controller** is a Python script that communicates with the build. You write your own controller script (though this repo contains many examples).
- The build and the controller communicate with each other over a TCP/IP socket.

## System Requirements

- Windows, OS X, or Linux (we've tested TDW on Ubuntu 16 and 18)
- Python 3.6+
- A GPU, the faster the better, with up-to-date drivers. It is possible to run TDW without a GPU but you will lose some speed and photorealism.
- For [audio/video recording](misc_frontend/video.md), you will need an audio driver.
- [Flex](misc_frontend/flex.md) has complicated requirements; please refer to the linked document.
- **Additional Linux server requirements:**
  - An active X server
  - nvidia graphics card
  - nvidia drivers (> 418.xx)
  - The server must have 8 or less GPUs. (If there are more, you can temporarily disable them by editing xorg.conf)
- **Additional Docker container requirements:**
  - Set Docker to run as a user in the Docker group. See this [link](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04).
  - Please test your nvidia-docker setup prior to starting TDW with Docker. The following command should execute succesfully: `docker run --gpus all nvidia/cuda:9.0-base nvidia-smi`
  - [nvidia-container-toolkit](https://github.com/NVIDIA/nvidia-docker)

## Install TDW on a personal computer

**We recommend installing TDW on a personal computer before attempting to install TDW on a remote server.** Installing on a personal computer is easier and it may help you understand the fundamentals of TDW.

1. OS X and Linux: **`sudo pip3 install tdw`** Windows: **`pip3 install tdw --user`** 
2. Create this Python script and run it:

```python
from tdw.controller import Controller

c = Controller()
print("Everything is OK!")
c.communicate({"$type": "terminate"})
```

**Result:** The terminal window will print messages about downloading a build. Then, it will launch a windowed application, print `Everything is OK!`, kill the windowed application process, and exit.

## Install TDW on a remote Linux server

1. `sudo pip3 install tdw`
2. Set up a virtual display. (Not all of these commands will be applicable to every server. The `:0` is the display number, which might vary between servers.)

```bash
sudo service lightdm stop
sudo killall Xorg
sudo nvidia-xconfig -a --use-display-device=None --virtual=256x256
sudo /usr/bin/X :0&
```

3. Download [the latest build of TDW](https://github.com/threedworld-mit/tdw/releases/latest/) and extract the zip file.
4. Verify that you can run TDW by running a minimal example. Create this Python script and save it as `my_controlller.py`:

```python
from tdw.controller import Controller

port = 1071  # This is the default port. You can change this.
c = Controller(launch_build=False, port=port) 
print("Everything is OK!")
c.communicate({"$type": "terminate"})
```

5. In one shell window, run the controller: `python3 my_controller.py`
6. Open another shell window.
7. In the second shell window, `cd` to the location of the build (`TDW.x86.64`)
8. In the second window, launch the build. Include the `DISPLAY` environment variable. This should match the display number of the virtual display (see "Install", above):

```bash
DISPLAY=:0.0 ./TDW.x86_64 -port=1071
```

## Install TDW in a Docker container

1. Allow the X server to accept local connections:

```bash
xhost +local:root
```

2. Pull a Docker container that matches [your version of TDW](../python/tdw.md):

```bash
cd tdw/Docker
```


```bash
./pull.sh
```

3. Verify that you can run TDW by running a minimal example. Create this Python script and save it as `my_controlller.py`:

```python
from tdw.controller import Controller

port = 1071  # This is the default port. You can change this.
c = Controller(launch_build=False, port=port) 
print("Everything is OK!")
c.communicate({"$type": "terminate"})
```

4. Run your controller.
5. Launch the container. [This is an example launch script.](https://github.com/threedworld-mit/tdw/blob/master/Docker/start_container.sh) You can also [use xpra for remote rendering](https://github.com/threedworld-mit/tdw/blob/master/Docker/start_container_xpra.sh).

We have [many other useful Docker scripts](https://github.com/threedworld-mit/tdw/tree/master/Docker).

It's also possible to run Docker within Docker (such as a Tensorflow container). Pass these to your Docker initialization options:

```bash
-v /var/run/docker.sock:/var/run/docker.sock
-v /usr/bin/docker:/bin/docker
```

## Install TDW on a personal computer and a remote Linux server

1. Follow directions for installing TDW on a personal computer.
2. On the Linux server, download [the latest build of TDW](https://github.com/threedworld-mit/tdw/releases/latest/) and extract the zip file.
4. On the Linux server,  `cd` to the location of the build (`TDW.x86.64`)
5. On the Linux server, launch the build. Include:
   - The `DISPLAY` environment variable, which should match the display number of the virtual display (see "Install", above)
   - The `-port` parameter (which should match the port of the controller)
   - The `-address` parameter (which should match the network address of the controller)

```bash
DISPLAY=:0.0 ./TDW.x86_64 -port=1071 -address=replace_with_the_controller_address
```

***

Next: [Auto-launching the TDW build](1.1.2_launch_build.md)

[Return to the README](../../README.md)
